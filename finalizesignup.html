<!DOCTYPE html>
<html>

<head>

	<title> GoodJob! - Terminar o Registro </title>

	<meta charset = "UTF-8" />
	<meta name = "viewport" content = "width=device-width, initial-scale=1" />

	<link rel = "apple-touch-icon" sizes = "180x180" href = "assets/favicon/apple-touch-icon.png">
	<link rel = "icon" type = "image/png" sizes = "32x32" href = "assets/favicon/favicon-32x32.png">
	<link rel = "icon" type = "image/png" sizes = "16x16" href = "assets/favicon/favicon-16x16.png">
	<link rel = "manifest" href = "assets/favicon/manifest.json">
	<link rel = "mask-icon" href = "assets/favicon/safari-pinned-tab.svg" color="#5bbad5">

	<link href = "https://fonts.googleapis.com/css?family=Poppins:200,300,400,500,600,700,800|Raleway:200,300,400,500,600,700" rel="stylesheet">

	<link rel = "stylesheet" href = "assets/css/SigninSingup-style.css" />

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>


	
	<script src="assets/jquery/jquery.validate.min.js"></script>

	<script> jQuery.extend(jQuery.validator.messages, {
    required: "Esse campo é necessário.",
    remote: "Please fix this field.",
    email: "Entre um email válido.",
    url: "Please enter a valid URL.",
    date: "Please enter a valid date.",
    dateISO: "Please enter a valid date (ISO).",
    number: "Please enter a valid number.",
    digits: "Please enter only digits.",
    creditcard: "Please enter a valid credit card number.",
    equalTo: "Please enter the same value again.",
    accept: "Please enter a value with a valid extension.",
    maxlength: jQuery.validator.format("Please enter no more than {0} characters."),
    minlength: jQuery.validator.format("Please enter at least {0} characters."),
    rangelength: jQuery.validator.format("Please enter a value between {0} and {1} characters long."),
    range: jQuery.validator.format("Please enter a value between {0} and {1}."),
    max: jQuery.validator.format("Please enter a value less than or equal to {0}."),
    min: jQuery.validator.format("Please enter a value greater than or equal to {0}.")
});

</script>

</head>

<body>
	
	<div class = "wrapper"> 
		<!-- Primary Box -->
		<section class = "primary-box">

			<video class = "pb-background" video autobuffer autoplay muted loop>
				<source id = "mp4" src = "assets/video/demo.mp4" type = "video/mp4">
				</video>
				<!-- Header -->
				<header class = "header">

					<a href = "index.html"><img src = "assets/img/logo.png" class = "logo"></a>

				</header>

				<div class = "pb-sb-fix">

					<article class = "pb-signupbox" id = "singup">

						<h1> Só mais um pouquinho... </h1>

						<h2> Seu registro está quase completo. Só precisamos de mais algumas informações! </h2>

						<p></p>

						<form class = "pb-sb-form">

							<input id = "email" class = "ps-sc-sb-textinput" type = "email" maxlength = "40" placeholder = "Email (utilizado para acessar)" required>

							<input id = "password" class = "ps-sc-sb-textinput" type = "password" maxlength = "25" placeholder = "Senha (utilizado para acessar)" required>

							<input id = "localization" class = "ps-sc-sb-textinput" type = "text" maxlength = "40" placeholder = "Localização" required>

							<input id = "representant" class = "ps-sc-sb-textinput" type = "text" maxlength = "25" placeholder = "Nome do Representante" required>

							<button class = "pb-sb-f-button" id = "FinishSignup"> Cadastrar </button>

						</form>

						<div class = "pb-triangle"> </div>

				</article>
			</div>
		</section>

	</div>

	<script>

		if (localStorage.getItem('projectn') != null) {

		} else {
			alert('Você precisa preencher algumas coisas antes! Vamos voltar?');
			window.location = "index.html";
		}
		
		let projectn = localStorage.getItem('projectn');
		let projectc = localStorage.getItem('projectc');
		let projectd = localStorage.getItem('projectd');
		let useremail = document.querySelector('#email');
		let userpassword = document.querySelector('#password');
		let projectloc = document.querySelector('#localization');
		let username = document.querySelector('#representant');

		console.log(projectn + projectc + projectd + useremail.value + userpassword.value + projectloc.value, username.value);

		function sendSignUpInfo(projectn, projectc, projectd, useremail, userpassword, projectloc, username){

            let xhttp = new XMLHttpRequest();

            xhttp.open("POST", "http://rest.learncode.academy/api/learncode/goodjobusers", true);
            xhttp.setRequestHeader("Content-Type","application/json");
            let info = {"email":useremail, "password":userpassword, "name":username, "pname":projectn, "pcat": projectc, "ploc":projectloc, "pdesc":projectd};
            let b = JSON.stringify(info);
            xhttp.send(b);
        }

        document.querySelector("#FinishSignup").onclick = function(){
        	event.preventDefault();
        	sendSignUpInfo(projectn, projectc, projectd, useremail.value, userpassword.value, projectloc.value, username.value);

        	if ($('.pb-sb-form').valid() == true) {
        	this.disabled = true;
        	this.style.cursor = 'wait';
        	this.style.backgroundColor = '#aaa';
        	setTimeout(function(){window.location = "login.html"}, 2000);

       		}
		}

	</script>

</body>
</html>